<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mht.modules.dm.dao.DefineIssueDao">

	<sql id="defineIssueColumns">
		d.id,
		d.issue_topic AS "topic",
		d.issue_content AS "content",
		d.dict_type_id  AS "dictType.id",
		d.issue_reason  AS "reason",
		d.issue_mean  AS "mean",
		d.issue_desc  AS "desc",
		d.create_by AS "createBy.id",
		d.create_date,
		d.update_by AS "updateBy.id",
		d.update_date
	</sql>
	
	<sql id="defineIssueJoins">
		LEFT JOIN dict_type dt ON dt.id = d.dict_type_id
    </sql>
	<select id="selectAll" resultType="DefineIssue">
		SELECT * FROM define_issue 
	</select>
	
	<select id="get" resultType="DefineIssue">
		SELECT
			<include refid="defineIssueColumns"/>
		FROM define_issue d
		<include refid="defineIssueJoins"/>
		WHERE d.id = #{id}
	</select>
	
	<select id="findList" resultType="DefineIssue">
		SELECT
			<include refid="defineIssueColumns"/>
		FROM define_issue d
		<include refid="defineIssueJoins"/>
		
		<if test="topic != null and topic != ''">
				WHERE d.topic like 
					<if test="dbName == 'oracle'">'%'||#{topic}||'%'</if>
				    <if test="dbName == 'mysql'">CONCAT('%', #{topic}, '%')</if>
		</if>
		 
	  </select>
			
	<insert id="insert">
		INSERT INTO define_issue(
			id, 
			issue_topic, 
			issue_content, 
			dict_type_id, 
			issue_reason, 
			issue_mean, 
			issue_desc , 
			create_by, 
			create_date, 
			update_by, 
			update_date
			
		) VALUES (
			#{id}, 
			#{topic}, 
			#{content}, 
			#{dictType.id}, 
			#{reason}, 
			#{mean}, 
			#{desc}, 
			#{createBy.id}, 
			#{createDate}, 
			#{updateBy.id}, 
			#{updateDate}, 
		)
	</insert>
	
	<update id="update">
		UPDATE define_issue d
		SET 
			issue_topic = #{topic}, 
			issue_content = #{content}, 
			dict_type_id = #{dictType.id}, 
			issue_reason = #{reason}, 
			issue_mean = #{mean}, 
			issue_desc = #{desc}, 
			d.update_by = #{updateBy.id}, 
			d.update_date = #{updateDate}, 
		WHERE d.id = #{id}
	</update>
	
	<delete id="delete">
		DELETE FROM define_issue  
		WHERE id = #{id}
	</delete>
	
	
</mapper>