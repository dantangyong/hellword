<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mht.define.portal.cms.dao.CmsVideoDao">
    
	<sql id="cmsVideoColumns">
		a.id AS "id",
		a.disable AS "disable",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.video_type_id AS "videoType.id",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag",
		a.sort AS "sort",
		a.video_url AS "videoUrl",
		a.video_priority AS "videoPriority",
		a.video_name AS "videoName",
		a.video_image AS "videoImage",
		a.video_detail AS "videoDetail",
		a.video_source AS "videoSource",
		a.hits AS "hits",
		u.name AS "createBy.name",
		vt.type_name AS "videoType.typeName"
	</sql>
	
	<sql id="cmsVideoJoins">
		LEFT JOIN mht_portal.cms_video_type vt ON vt.id = a.video_type_id
		LEFT JOIN mht_base.sys_user u ON u.id = a.create_by
	</sql>
	
    
	<select id="get" resultType="CmsVideo" >
		SELECT 
			<include refid="cmsVideoColumns"/>
		FROM mht_portal.cms_video a
		<include refid="cmsVideoJoins"/>
		
		WHERE 1=1 
		<if test="_parameter != null and _parameter != ''">
		AND a.id = #{id}
		</if>
	</select>
	
	
	<select id="findList" resultType="CmsVideo" >
		SELECT 
			<include refid="cmsVideoColumns"/>
		FROM mht_portal.cms_video a
		<include refid="cmsVideoJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
			<if test="id != null and id != ''">
			AND a.id = #{id}
			</if>
			<if test="videoName != null and videoName != ''">
				AND a.video_name LIKE 
				<if test="dbName == 'oracle'">'%'||#{videoName}||'%'</if>
				<if test="dbName == 'mssql'">'%'+#{videoName}+'%'</if>
				<if test="dbName == 'mysql'">CONCAT('%', #{videoName}, '%')</if>
			</if>
			<if test="videoType.id!=null and videoType.id!=''">
				AND vt.id=#{videoType.id}  
			</if>
<!-- 			<if test="createBy.id!=null and createBy.id!=''"> -->
<!-- 				AND u.id=#{createBy.id}   -->
<!-- 			</if> -->
			
			<if test="disable != null and disable != ''">
				AND a.disable = #{disable} 
			</if>
			
			<if test="videoPriority != null and videoPriority != ''">
				AND a.video_priority = #{videoPriority} 
			</if>
		</where>
		<choose>
			<when test="page!=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	
	
	<select id="selectcount" resultType = "java.lang.Integer">
		select count(*) 
		FROM mht_portal.cms_video a
		<include refid="cmsVideoJoins"/>
		WHERE  a.disable ='1' and a.del_flag='0'
	</select>
	
<!-- 	前台页面 -->
		<select id="selectList" resultType="CmsVideo" >
			SELECT 
				<include refid="cmsVideoColumns"/>
			FROM mht_portal.cms_video a
			<include refid="cmsVideoJoins"/>
			<where>
				a.del_flag = #{video.delFlag}
				<if test="video.id != null and video.id != ''">
				AND a.id = #{id}
				</if>
				<if test="video.videoName != null and video.videoName != ''">
					AND a.video_name LIKE 
					<if test="dbName == 'oracle'">'%'||#{video.videoName}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{video.videoName}+'%'</if>
					<if test="dbName == 'mysql'">CONCAT('%', #{video.videoName}, '%')</if>
				</if>
				<if test="video.disable != null and video.disable != ''">
					AND a.disable = #{video.disable} 
				</if>
				<if test="video.videoType.id != null and video.videoType.id != ''">
					AND a.video_type_id = #{video.videoType.id} 
				</if>
				<if test="video.hits != null and video.hits != ''">
					AND a.hits = #{video.hits} 
				</if>
				<if test="video.videoPriority != null and video.videoPriority != ''">
					AND a.video_priority = #{video.videoPriority} 
				</if>
				<if test="video.sort==1">
					ORDER BY a.sort DESC
				</if>
				<if test="video.sort==2">
					ORDER BY a.update_date DESC
				</if>
				<if test="video.sort==3">
					ORDER BY a.hits DESC
				</if>
				<if test="pb.pageSize>0">
				    limit #{pb.start},#{pb.pageSize}
				</if>
				<if test="pb.pageSize==0">
				    limit 0,9
				</if>
			</where>
	</select>
	
	
	<select id="findAllList" resultType="CmsVideo" >
		SELECT 
			<include refid="cmsVideoColumns"/>
		FROM mht_portal.cms_video a
		<include refid="cmsVideoJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO mht_portal.cms_video(
			id,
			create_by,
			create_date,
			update_by,
			update_date,
			remarks,
			video_type_id,
			del_flag,
			video_url,
			sort,
			video_name,
			video_image,
			video_detail,
			video_source,
			video_priority,
			hits,
			disable
		) VALUES (
			#{id},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{remarks},
			#{videoType.id},
			#{delFlag},
			#{videoUrl},
			#{sort},
			#{videoName},
			#{videoImage},
			#{videoDetail},
			#{videoSource},
			#{videoPriority},
			#{hits},
			#{disable}
		)
	</insert>
	
	<update id="update">
		UPDATE mht_portal.cms_video SET 	
			video_url = #{videoUrl},
			video_type_id = #{videoType.id},
			sort = #{sort},
			video_name = #{videoName},
			video_image = #{videoImage},
			video_detail = #{videoDetail},
			video_source = #{videoSource},
			update_date = #{updateDate},
			disable = #{disable},
			hits = #{hits},
			video_priority = #{videoPriority}
		WHERE id = #{id}
	</update>
	<update id="disableVideo">
	UPDATE mht_portal.cms_video SET 	
			disable = #{videoType.disable}
		WHERE video_type_id = #{videoType.id}
	</update>
	
	<!--物理删除-->
	<update id="delete">
		DELETE FROM mht_portal.cms_video
		WHERE id = #{id}
	</update>
	
	<update id="updateHitsAddOne">
		update mht_portal.cms_video set
			 hits = hits+1
		 WHERE id = #{id}
	</update>
	
</mapper>